<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>

    <title>JavaScript高级程序设计（第4版）</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" type="text/css" href="../stylesheet.css"/>
    <link rel="stylesheet" type="text/css" href="../page_styles.css"/>

    <link href="../calibreHtmlOutBasicCss.css" type="text/css" rel="stylesheet"/>

  </head>
  <body>

    <div class="calibreMeta">
      <div class="calibreMetaTitle">

        <h1>
          <a href="../../54m0dfqx.html">JavaScript高级程序设计（第4版）
          </a>
        </h1>

      </div>
      <div class="calibreMetaAuthor">
        [美] 马特 • 弗里斯比

      </div>
    </div>

    <div class="calibreMain">

      <div class="calibreEbookContent">

        <div class="calibreEbNavTop">

          <a href="part0147.html" class="calibreAPrev">上一页
          </a>

          <a href="part0149.html" class="calibreANext">下一页
          </a>

        </div>

        <h2 id="nav_point_465" class="calibre9">20.5 媒体元素</h2>
        <p class="calibre1">随着嵌入音频和视频元素在Web应用上的流行，大多数内容提供商会强迫使用Flash以便达到最佳的跨浏览器兼容性。HTML5新增了两个与媒体相关的元素，即<code class="calibre11">&lt;audio&gt;</code>和<code class="calibre11">&lt;video&gt;</code>，从而为浏览器提供了嵌入音频和视频的统一解决方案。</p>
        <p class="calibre1">这两个元素既支持Web开发者在页面中嵌入媒体文件，也支持JavaScript实现对媒体的自定义控制。以下是它们的用法：</p>
        <pre class="dai_ma_wu_xing_hao"><code class="calibre11">&lt;!-- 嵌入视频 --&gt;
&lt;video src="conference.mpg" id="myvideo"&gt;video player not available.&lt;/video&gt;
&lt;!-- 嵌入音频 --&gt;
&lt;audio src="song.mp3" id="myaudio"&gt;audio player not available.&lt;/audio&gt;</code></pre>
        <p class="calibre1">每个元素至少要求有一个<code class="calibre11">src</code>属性，以表示要加载的媒体文件。我们也可以指定表示视频播放器大小的<code class="calibre11">width</code>和<code class="calibre11">height</code>属性，以及在视频加载期间显示图片URI的<code class="calibre11">poster</code>属性。另外，<code class="calibre11">controls</code>属性如果存在，则表示浏览器应该显示播放界面，让用户可以直接控制媒体。开始和结束标签之间的内容是在媒体播放器不可用时显示的替代内容。</p>
        <p class="calibre1">由于浏览器支持的媒体格式不同，因此可以指定多个不同的媒体源。为此，需要从元素中删除<code class="calibre11">src</code>属性，使用一个或多个<code class="calibre11">&lt;source&gt;</code>元素代替，如下面的例子所示：</p>
        <pre class="dai_ma_wu_xing_hao"><code class="calibre11">&lt;!-- 嵌入视频 --&gt;
&lt;video id="myvideo"&gt;
  &lt;source src="conference.webm" type="video/webm; codecs='vp8, vorbis'"&gt;
  &lt;source src="conference.ogv" type="video/ogg; codecs='theora, vorbis'"&gt;
  &lt;source src="conference.mpg"&gt;
  video player not available.
&lt;/video&gt;
&lt;!-- 嵌入音频 --&gt;
&lt;audio id="myaudio"&gt;
  &lt;source src="song.ogg" type="audio/ogg"&gt;
  &lt;source src="song.mp3" type="audio/mpeg"&gt;
  audio player not available.
&lt;/audio&gt;</code></pre>
        <p class="calibre1">讨论不同音频和视频的编解码器超出了本书范畴，但浏览器支持的编解码器确实可能有所不同，因此指定多个源文件通常是必需的。</p>
        <h3 id="nav_point_466" class="calibre15">20.5.1 属性</h3>
        <p class="calibre1">
          <code class="calibre11">&lt;video&gt;</code>和<code class="calibre11">&lt;audio&gt;</code>元素提供了稳健的JavaScript接口。这两个元素有很多共有属性，可以用于确定媒体的当前状态，如下表所示。</p>
        <table width="90%" border="1" class="table">
          <thead class="calibre22">
            <tr class="calibre23">
              <th class="calibre19">
                <p class="calibre1">属性</p>
              </th>
              <th class="calibre19">
                <p class="calibre1">数据类型</p>
              </th>
              <th class="calibre19">
                <p class="calibre1">说明</p>
              </th>
            </tr>
          </thead>
          <tbody class="calibre24">
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">autoplay</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">Boolean</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">取得或设置<code class="calibre27">autoplay</code>标签</p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">buffered</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">TimeRanges</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">对象，表示已下载缓冲的时间范围</p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">bufferedBytes</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">ByteRanges</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">对象，表示已下载缓冲的字节范围</p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">bufferingRate</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">Integer</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">平均每秒下载的位数</p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">bufferingThrottled</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">Boolean</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">表示缓冲是否被浏览器截流</p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">controls</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">Boolean</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">取得或设置<code class="calibre27">controls</code>属性，用于显示或隐藏浏览器内置控件</p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">currentLoop</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">Integer</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">媒体已经播放的循环次数</p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">currentSrc</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">String</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">当前播放媒体的URL</p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">currentTime</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">Float</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">已经播放的秒数</p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">defaultPlaybackRate</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">Float</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">取得或设置默认回放速率。默认为1.0秒</p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">duration</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">Float</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">媒体的总秒数</p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">ended</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">Boolean</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">表示媒体是否播放完成</p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">loop</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">Boolean</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">取得或设置媒体是否应该在播放完再循环开始</p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">muted</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">Boolean</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">取得或设置媒体是否静音</p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">networkState</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">Integer</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">表示媒体当前网络连接状态。0表示空，1表示加载中，2表示加载元数据，3表示加载了第一帧，4表示加载完成</p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">paused</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">Boolean</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">表示播放器是否暂停</p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">playbackRate</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">Float</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">取得或设置当前播放速率。用户可能会让媒体播放快一些或慢一些。与<code class="calibre27">defaultPlaybackRate</code>不同，该属性会保持不变，除非开发者修改</p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">played</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">TimeRanges</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">到目前为止已经播放的时间范围</p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">readyState</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">Integer</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">表示媒体是否已经准备就绪。0表示媒体不可用，1表示可以显示当前帧，2表示媒体可以开始播放，3表示媒体可以从头播到尾</p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">seekable</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">TimeRanges</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">可以跳转的时间范围</p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">seeking</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">Boolean</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">表示播放器是否正移动到媒体文件的新位置</p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">src</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">String</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">媒体文件源。可以在任何时候重写</p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">首页</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">Float</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">取得或设置媒体文件中的位置，以秒为单位，从该处开始播放</p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">totalBytes</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">Integer</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">资源需要的字节总数（如果知道的话）</p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">videoHeight</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">Integer</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">返回视频（不一定是元素）的高度。只适用于<code class="calibre27">&lt;video&gt;</code>
                </p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">videoWidth</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">Integer</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">返回视频（不一定是元素）的宽度。只适用于<code class="calibre27">&lt;video&gt;</code>
                </p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">volume</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">Float</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">取得或设置当前音量，值为0.0到1.0</p>
              </td>
            </tr>
          </tbody>
        </table>
        <p class="calibre1">上述很多属性也可以在<code class="calibre11">&lt;audio&gt;</code>或<code class="calibre11">&lt;video&gt;</code>标签上设置。</p>
        <h3 id="nav_point_467" class="calibre15">20.5.2 事件</h3>
        <p class="calibre1">除了有很多属性，媒体元素还有很多事件。这些事件会监控由于媒体回放或用户交互导致的不同属性的变化。下表列出了这些事件。</p>
        <table width="90%" border="1" class="table">
          <thead class="calibre22">
            <tr class="calibre23">
              <th class="calibre19">
                <p class="calibre1">事件</p>
              </th>
              <th class="calibre19">
                <p class="calibre1">何时触发</p>
              </th>
            </tr>
          </thead>
          <tbody class="calibre24">
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">abort</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">下载被中断</p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">canplay</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">回放可以开始，<code class="calibre27">readyState</code>为2</p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">canplaythrough</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">回放可以继续，不应该中断，<code class="calibre27">readState</code>为3</p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">canshowcurrentframe</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">已经下载当前帧，<code class="calibre27">readyState</code>为1</p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">dataunavailable</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">不能回放，因为没有数据，<code class="calibre27">readyState</code>为0</p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">durationchange</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">duration</code>属性的值发生变化</p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">emptied</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">网络连接关闭了</p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">empty</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">发生了错误，阻止媒体下载</p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">ended</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">媒体已经播放完一遍，且停止了</p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">error</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">下载期间发生了网络错误</p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">load</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">所有媒体已经下载完毕。这个事件已被废弃，使用<code class="calibre27">canplaythrough</code>代替</p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">loadeddata</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">媒体的第一帧已经下载</p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">loadedmetadata</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">媒体的元数据已经下载</p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">loadstart</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">下载已经开始</p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">pause</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">回放已经暂停</p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">play</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">媒体已经收到开始播放的请求</p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">playing</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">媒体已经实际开始播放了</p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">progress</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">下载中</p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">ratechange</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">媒体播放速率发生变化</p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">seeked</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">跳转已结束</p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">seeking</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">回放已移动到新位置</p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">stalled</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">浏览器尝试下载，但尚未收到数据</p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">timeupdate</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">currentTime</code>被非常规或意外地更改了</p>
              </td>
            </tr>
            <tr class="calibre25">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">volumechange</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">volume</code>或<code class="calibre27">muted</code>属性值发生了变化</p>
              </td>
            </tr>
            <tr class="calibre23">
              <td class="calibre21">
                <p class="calibre1">
                  <code class="calibre27">waiting</code>
                </p>
              </td>
              <td class="calibre21">
                <p class="calibre1">回放暂停，以下载更多数据</p>
              </td>
            </tr>
          </tbody>
        </table>
        <p class="calibre1">这些事件被设计得尽可能具体，以便Web开发者能够使用较少的HTML和JavaScript创建自定义的音频/视频播放器（而不是创建新Flash影片）。</p>
        <h3 id="nav_point_468" class="calibre15">20.5.3 自定义媒体播放器</h3>
        <p class="calibre1">使用<code class="calibre11">&lt;audio&gt;</code>和<code class="calibre11">&lt;video&gt;</code>的<code class="calibre11">play()</code>和<code class="calibre11">pause()</code>方法，可以手动控制媒体文件的播放。综合使用属性、事件和这些方法，可以方便地创建自定义的媒体播放器，如下面的例子所示：</p>
        <pre class="dai_ma_wu_xing_hao"><code class="calibre11">&lt;div class="mediaplayer"&gt;
  &lt;div class="video"&gt;
    &lt;video id="player" src="movie.mov" poster="mymovie.jpg"
           width="300" height="200"&gt;
      video player not available.
    &lt;/video&gt;
  &lt;/div&gt;
  &lt;div class="controls"&gt;
    &lt;input type="button" value="play" id="video-btn"&gt;
    &lt;span id="curtime"&gt;0&lt;/span&gt;/&lt;span id="duration"&gt;0&lt;/span&gt;
  &lt;/div&gt;
&lt;/div&gt;</code></pre>
        <p class="calibre1">通过使用JavaScript创建一个简单的视频播放器，上面这个基本的HTML就可以被激活了，如下所示：</p>
        <pre class="dai_ma_wu_xing_hao"><code class="calibre11">// 取得元素的引用
let player = document.getelementbyid("player"),
  btn = document.getelementbyid("video-btn"),
  curtime = document.getelementbyid("curtime"),
  duration = document.getelementbyid("duration");
// 更新时长
duration.innerhtml = player.duration;

// 为按钮添加事件处理程序
btn.addeventlistener( "click", (event) =&gt; {
  if (player.paused) {
    player.play();
    btn.value = "pause";
  } else {
    player.pause();
    btn.value = "play";
  }
});

// 周期性更新当前时间
setinterval(() =&gt; {
  curtime.innerhtml = player.currenttime;
}, 250);</code></pre>
        <p class="calibre1">这里的JavaScript代码简单地为按钮添加了事件处理程序，可以根据当前状态播放和暂停视频。此外，还给<code class="calibre11">&lt;video&gt;</code>元素的<code class="calibre11">load</code>事件添加了事件处理程序，以便显示视频的时长。最后，重复的计时器用于更新当前时间。通过监听更多事件以及使用更多属性，可以进一步扩展这个自定义的视频播放器。同样的代码也可以用于<code class="calibre11">&lt;audio&gt;</code>元素以创建自定义的音频播放器。</p>
        <h3 id="nav_point_469" class="calibre15">20.5.4 检测编解码器</h3>
        <p class="calibre1">如前所述，并不是所有浏览器都支持<code class="calibre11">&lt;video&gt;</code>和<code class="calibre11">&lt;audio&gt;</code>的所有编解码器，这通常意味着必须提供多个媒体源。为此，也有JavaScript API可以用来检测浏览器是否支持给定格式和编解码器。这两个媒体元素都有一个名为<code class="calibre11">canPlayType()</code>的方法，该方法接收一个格式/编解码器字符串，返回一个字符串值：<code class="calibre11">"probably"</code>、<code class="calibre11">"maybe"</code>或<code class="calibre11">""</code>（空字符串），其中空字符串就是假值，意味着可以在<code class="calibre11">if</code>语句中像这样使用<code class="calibre11">canPlayType()</code>：</p>
        <pre class="dai_ma_wu_xing_hao"><code class="calibre11">if (audio.canplaytype("audio/mpeg")) {
  // 执行某些操作
}</code></pre>
        <p class="calibre1">
          <code class="calibre11">"probably"</code>和<code class="calibre11">"maybe"</code>都是真值，在<code class="calibre11">if</code>语句的上下文中可以转型为<code class="calibre11">true</code>。</p>
        <p class="calibre1">在只给<code class="calibre11">canPlayType()</code>提供一个MIME类型的情况下，最可能返回的值是<code class="calibre11">"maybe"</code>和空字符串。这是因为文件实际上只是一个包装音频和视频数据的容器，而真正决定文件是否可以播放的是编码。在同时提供MIME类型和编解码器的情况下，返回值的可能性会提高到<code class="calibre11">"probably"</code>。下面是几个例子：</p>
        <pre class="dai_ma_wu_xing_hao"><code class="calibre11">let audio = document.getelementbyid("audio-player");
// 很可能是"maybe"
if (audio.canplaytype("audio/mpeg")) {
  // 执行某些操作
}
// 可能是"probably"
if (audio.canplaytype("audio/ogg; codecs=\"vorbis\"")) {
  // 执行某些操作
}</code></pre>
        <p class="calibre1">注意，编解码器必须放到引号中。同样，也可以在视频元素上使用<code class="calibre11">canPlayType()</code>检测视频格式。</p>
        <h3 id="nav_point_470" class="calibre15">20.5.5 音频类型</h3>
        <p class="calibre1">
          <code class="calibre11">&lt;audio&gt;</code>元素还有一个名为<code class="calibre11">Audio</code>的原生JavaScript构造函数，支持在任何时候播放音频。<code class="calibre11">Audio</code>类型与<code class="calibre11">Image</code>类似，都是DOM元素的对等体，只是不需插入文档即可工作。要通过Audio播放音频，只需创建一个新实例并传入音频源文件：</p>
        <pre class="dai_ma_wu_xing_hao"><code class="calibre11">let audio = new audio("sound.mp3");
eventutil.addhandler(audio, "canplaythrough", function(event) {
  audio.play();
});</code></pre>
        <p class="calibre1">创建<code class="calibre11">Audio</code>的新实例就会开始下载指定的文件。下载完毕后，可以调用<code class="calibre11">play()</code>来播放音频。</p>
        <p class="calibre1">在iOS中调用<code class="calibre11">play()</code>方法会弹出一个对话框，请求用户授权播放声音。为了连续播放，必须在<code class="calibre11">onfinish</code>事件处理程序中立即调用<code class="calibre11">play()</code>。</p>

      </div>

      <div class="calibreToc">
        <h2>
          <a href="../../54m0dfqx.html">Table of contents
          </a>
        </h2>
        <div>
          <ul>
            <li>
              <a href="part0002.html#nav_point_0">版权声明</a>
            </li>
            <li>
              <a href="part0003.html#nav_point_1">献词</a>
            </li>
            <li>
              <a href="part0004.html#nav_point_2">译者序</a>
            </li>
            <li>
              <a href="part0005.html#nav_point_3">序</a>
            </li>
            <li>
              <a href="part0006.html#nav_point_4">前言</a>
            </li>
            <li>
              <a href="part0012.html#nav_point_10">致谢</a>
            </li>
            <li>
              <a href="part0013.html#nav_point_11">第 1 章 什么是JavaScript</a>
            </li>
            <li>
              <a href="part0018.html#nav_point_19">第 2 章 HTML中的JavaScript</a>
            </li>
            <li>
              <a href="part0024.html#nav_point_31">第 3 章 语言基础</a>
            </li>
            <li>
              <a href="part0033.html#nav_point_78">第 4 章 变量、作用域与内存</a>
            </li>
            <li>
              <a href="part0038.html#nav_point_93">第 5 章 基本引用类型</a>
            </li>
            <li>
              <a href="part0044.html#nav_point_111">第 6 章 集合引用类型</a>
            </li>
            <li>
              <a href="part0054.html#nav_point_153">第 7 章 迭代器与生成器</a>
            </li>
            <li>
              <a href="part0059.html#nav_point_166">第 8 章 对象、类与面向对象编程</a>
            </li>
            <li>
              <a href="part0065.html#nav_point_194">第 9 章 代理与反射</a>
            </li>
            <li>
              <a href="part0070.html#nav_point_225">第 10 章 函数</a>
            </li>
            <li>
              <a href="part0088.html#nav_point_258">第 11 章 期约与异步函数</a>
            </li>
            <li>
              <a href="part0093.html#nav_point_273">第 12 章 BOM</a>
            </li>
            <li>
              <a href="part0100.html#nav_point_294">第 13 章 客户端检测</a>
            </li>
            <li>
              <a href="part0105.html#nav_point_306">第 14 章 DOM</a>
            </li>
            <li>
              <a href="part0110.html#nav_point_328">第 15 章 DOM扩展</a>
            </li>
            <li>
              <a href="part0116.html#nav_point_348">第 16 章 DOM2和DOM3</a>
            </li>
            <li>
              <a href="part0122.html#nav_point_370">第 17 章 事件</a>
            </li>
            <li>
              <a href="part0130.html#nav_point_403">第 18 章 动画与Canvas图形</a>
            </li>
            <li>
              <a href="part0136.html#nav_point_428">第 19 章 表单脚本</a>
            </li>
            <li>
              <a href="part0143.html#nav_point_450">第 20 章 JavaScript API</a>
            </li>
            <li>
              <a href="part0157.html#nav_point_500">第 21 章 错误处理与调试</a>
            </li>
            <li>
              <a href="part0163.html#nav_point_526">第 22 章 处理XML</a>
            </li>
            <li>
              <a href="part0168.html#nav_point_542">第 23 章 JSON</a>
            </li>
            <li>
              <a href="part0172.html#nav_point_552">第 24 章 网络请求与远程资源</a>
            </li>
            <li>
              <a href="part0182.html#nav_point_582">第 25 章 客户端存储</a>
            </li>
            <li>
              <a href="part0187.html#nav_point_607">第 26 章 模块</a>
            </li>
            <li>
              <a href="part0193.html#nav_point_633">第 27 章 工作者线程</a>
            </li>
            <li>
              <a href="part0199.html#nav_point_667">第 28 章 最佳实践</a>
            </li>
            <li>
              <a href="part0204.html#nav_point_683">附录 A ES2018和ES2019</a>
            </li>
            <li>
              <a href="part0215.html#nav_point_708">附录 B 严格模式</a>
            </li>
            <li>
              <a href="part0223.html#nav_point_719">附录 C JavaScript库和框架</a>
            </li>
            <li>
              <a href="part0227.html#nav_point_741">附录 D JavaScript工具</a>
            </li>
            <li>
              <a href="part0239.html#nav_point_800">作者简介</a>
            </li>
          </ul>
        </div>

      </div>

      <div class="calibreEbNav">

        <a href="part0147.html" class="calibreAPrev">上一页
        </a>

        <a href="../../54m0dfqx.html" class="calibreAHome">首页
        </a>

        <a href="part0149.html" class="calibreANext">下一页
        </a>

      </div>

    </div>

    <script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6487844781006261" crossorigin="anonymous"></script>
  </body>
</html>